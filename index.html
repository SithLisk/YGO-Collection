<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Yu-Gi-Oh! Collection Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Cinzel:wght@400;600;700&family=Crimson+Pro:ital,wght@0,300;0,400;0,600;1,300;1,400&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="page-bg"></div>
<div class="stars"></div>
<div class="wrap">

  <header style="position:relative">
    <div class="bg-overlay" style="position:absolute;inset:0;background:linear-gradient(to bottom, rgba(8,4,4,0.82) 0%, rgba(8,4,4,0.72) 60%, rgba(8,4,4,0.55) 100%);border-radius:0;pointer-events:none;z-index:0"></div>
    <div style="position:relative;z-index:1">
    <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px;margin-bottom:8px">
    <div class="eyebrow" style="margin-bottom:0">Live API &middot; Cloud Sync &middot; YGOPRODeck</div>
    <div class="active-profile-bar">
      <span>Viewing:</span>
      <span class="active-profile-name" id="activeProfileLabel">â€”</span>
      <button class="btn-test" onclick="showProfileScreen()" style="padding:4px 12px;font-size:9px">Switch Profile</button>
    </div>
  </div>
  <div class="eyebrow" style="display:none">placeholder</div>
    <h1><span id="headerProfileName">Yu-Gi-Oh!</span><br>Collection Tracker</h1>
    <p class="subtitle">Search. Add. Sort. Enjoy.</p>
    </div>
  </header>

  <div class="sync-bar">
    <div class="sync-row">
      <div class="sync-dot" id="syncDot"></div>
      <span id="syncLabel">Connecting&hellip;</span>
    </div>
    <div style="display:flex;align-items:center;gap:10px">
      <span style="color:var(--silver-dim);font-size:9px;letter-spacing:1px">Changes sync automatically across all devices</span>
      <select class="theme-select" id="themeSelect" onchange="applyTheme(this.value)" title="Color theme">
        <option value="">&#127756; Maroon</option>
        <option value="dusk">&#127754; Dusk</option>
        <option value="void">&#127807; Void</option>
        <option value="ivory">&#127774; Ivory</option>
      </select>
      <button class="btn-test" id="lockBtn" onclick="toggleAuth()" style="padding:5px 12px;font-size:9px">&#x1F512; Locked</button>
    </div>
  </div>

  <!-- Profile Selector Screen -->
  <div id="profileScreen" style="display:flex;position:fixed;inset:0;z-index:2000;align-items:center;justify-content:center;overflow-y:auto;padding:40px 20px">
    <!-- Background layers matching page theme -->
    <div style="position:absolute;inset:0;background:rgba(4,1,1,0.96)"></div>
    <div style="position:absolute;inset:0;background-image:url('bg.png');background-size:cover;background-position:center;opacity:0.08;pointer-events:none"></div>
    <div style="position:absolute;inset:0;background:radial-gradient(ellipse 80% 50% at 50% 0%,rgba(160,30,30,0.3) 0%,transparent 60%);pointer-events:none"></div>

    <div style="position:relative;z-index:1;text-align:center;width:100%;max-width:780px">
      <!-- Logo / Title -->
      <div style="font-family:'Cinzel',serif;font-size:10px;letter-spacing:6px;color:var(--gold-dim);text-transform:uppercase;margin-bottom:14px">Yu-Gi-Oh! Collection Tracker</div>
      <h1 style="font-family:'Cinzel Decorative',serif;font-size:clamp(20px,4vw,34px);color:var(--gold-pale);letter-spacing:3px;margin-bottom:8px;text-shadow:0 0 30px rgba(240,192,64,0.3)"><span id="profileScreenName">Collection</span></h1>
      <div style="width:120px;height:1px;background:linear-gradient(to right,transparent,var(--gold-dim),transparent);margin:12px auto 20px"></div>
      <p style="font-family:'Cinzel',serif;font-size:10px;letter-spacing:3px;color:var(--silver-dim);text-transform:uppercase;margin-bottom:36px">Select a Profile</p>

      <!-- Profile grid -->
      <div id="profileGrid" style="display:flex;flex-wrap:wrap;gap:20px;justify-content:center;margin-bottom:32px"></div>

      <p style="font-size:12px;color:rgba(180,160,160,0.4);font-style:italic">Browse any collection freely &middot; Password required to add or edit cards</p>
    </div>
  </div>

  <!-- New Profile Modal -->
  <div id="newProfileModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.88);z-index:3000;align-items:center;justify-content:center">
    <div style="background:linear-gradient(135deg,rgba(28,5,5,0.98),rgba(10,2,2,0.99));border:1px solid rgba(240,192,64,0.25);border-radius:18px;padding:36px 32px;width:340px;text-align:center;box-shadow:0 0 60px rgba(160,30,30,0.35),0 0 0 1px rgba(240,192,64,0.08)">
      <div style="font-size:28px;margin-bottom:12px">&#x2694;</div>
      <div style="font-family:'Cinzel',serif;font-size:12px;letter-spacing:4px;color:var(--gold);text-transform:uppercase;margin-bottom:6px">New Profile</div>
      <div style="width:60px;height:1px;background:linear-gradient(to right,transparent,var(--gold-dim),transparent);margin:0 auto 20px"></div>
      <input id="newProfileName" type="text" placeholder="Enter your name" maxlength="24" autocomplete="off"
        style="background:rgba(6,1,1,0.8);border:1px solid rgba(240,192,64,0.2);border-radius:10px;color:var(--white);font-family:'Cinzel',serif;font-size:15px;letter-spacing:2px;padding:12px 16px;outline:none;width:100%;margin-bottom:12px;text-align:center;transition:border-color 0.2s"
        onfocus="this.style.borderColor='rgba(240,192,64,0.5)'" onblur="this.style.borderColor='rgba(240,192,64,0.2)'"
        onkeydown="if(event.key==='Enter')document.getElementById('newProfilePw').focus()">
      <input id="newProfilePw" type="password" placeholder="Password" autocomplete="off"
        style="background:rgba(6,1,1,0.8);border:1px solid rgba(240,192,64,0.2);border-radius:10px;color:var(--white);font-family:'Cinzel',serif;font-size:15px;letter-spacing:2px;padding:12px 16px;outline:none;width:100%;margin-bottom:10px;text-align:center;transition:border-color 0.2s"
        onfocus="this.style.borderColor='rgba(240,192,64,0.5)'" onblur="this.style.borderColor='rgba(240,192,64,0.2)'"
        onkeydown="if(event.key==='Enter')createProfile()">
      <div id="newProfileError" style="color:#f87171;font-family:'Cinzel',serif;font-size:10px;letter-spacing:1px;margin-bottom:14px;min-height:14px"></div>
      <div style="display:flex;gap:10px;justify-content:center">
        <button onclick="createProfile()"
          style="font-family:'Cinzel',serif;font-size:10px;letter-spacing:2px;text-transform:uppercase;background:linear-gradient(135deg,rgba(160,30,30,0.8),rgba(100,10,10,0.9));border:1px solid rgba(240,192,64,0.3);border-radius:8px;color:var(--gold-pale);padding:10px 28px;cursor:pointer;transition:all 0.2s"
          onmouseover="this.style.background='linear-gradient(135deg,rgba(200,40,40,0.9),rgba(140,15,15,0.95))'"
          onmouseout="this.style.background='linear-gradient(135deg,rgba(160,30,30,0.8),rgba(100,10,10,0.9))'">
          Create
        </button>
        <button onclick="closeNewProfileModal()"
          style="font-family:'Cinzel',serif;font-size:10px;letter-spacing:2px;text-transform:uppercase;background:rgba(255,255,255,0.04);border:1px solid var(--border);border-radius:8px;color:var(--silver-dim);padding:10px 20px;cursor:pointer;transition:all 0.2s"
          onmouseover="this.style.color='var(--silver)'" onmouseout="this.style.color='var(--silver-dim)'">
          Cancel
        </button>
      </div>
    </div>
  </div>

  <div id="pwModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.75);z-index:1000;align-items:center;justify-content:center;">
    <div style="background:#1a0505;border:1px solid var(--border);border-radius:16px;padding:36px;min-width:320px;box-shadow:var(--glow);text-align:center">
      <div style="font-family:'Cinzel',serif;font-size:13px;letter-spacing:3px;color:var(--gold);text-transform:uppercase;margin-bottom:20px">Enter Password</div>
      <input type="password" id="pwInput" placeholder="Password" style="width:100%;margin-bottom:12px" onkeydown="if(event.key==='Enter')submitPw()">
      <div id="pwError" style="color:#f87171;font-size:13px;font-style:italic;margin-bottom:12px;min-height:18px"></div>
      <div style="display:flex;gap:10px;justify-content:center">
        <button class="btn btn-add" onclick="submitPw()" style="padding:9px 20px;font-size:10px">Unlock</button>
        <button class="btn-test" onclick="closePwModal()" style="align-self:center">Cancel</button>
      </div>
    </div>
  </div>

  <div class="search-panel">
    <div class="sec-label">Search Card Database</div>
    <div class="test-bar">
      <button class="btn-test" onclick="testAPI()">Test API Connection</button>
      <span id="testResult"></span>
    </div>
    <div class="search-row">
      <div class="search-wrap">
        <input type="text" id="cardSearch" placeholder="Type a card name &mdash; e.g. Dark Magician, Ash Blossom&hellip;" autocomplete="off">
        <div class="ac-list" id="acList"></div>
      </div>
      <span class="status-msg" id="statusMsg"></span>
    </div>

    <div class="card-preview" id="cardPreview">
      <div class="preview-grid">
        <div class="img-wrap" id="cardImgWrap"><div class="img-ph">&#x1F0A3;</div></div>
        <div class="card-info">
          <div class="card-name" id="previewName"></div>
          <div class="card-meta" id="previewMeta"></div>
          <div class="atk-def" id="previewAtkDef"></div>
          <div class="card-eff" id="previewEffect"></div>
          <div class="card-set" id="previewSet"></div>
        </div>
      </div>
      <div class="entry-form" id="entryForm">
        <div class="field"><label>Quantity</label><input type="number" id="fQty" value="1" min="1" max="99" style="width:80px"></div>
        <div class="field"><label>Rarity</label>
          <select id="fRarity">
            <option>Common</option><option>Rare</option><option>Super Rare</option>
            <option>Ultra Rare</option><option>Secret Rare</option><option>Prismatic Secret Rare</option>
            <option>Ghost Rare</option><option>Starlight Rare</option><option>Quarter Century Secret Rare</option>
          </select>
        </div>
        <div class="field"><label>Condition</label>
          <select id="fCondition">
            <option>Mint</option><option selected>Near Mint</option><option>Lightly Played</option>
            <option>Moderately Played</option><option>Heavily Played</option><option>Damaged</option>
          </select>
        </div>
        <div class="field"><label>Edition</label>
          <select id="fEdition"><option>Unlimited</option><option>1st Edition</option><option>Limited Edition</option></select>
        </div>

        <div class="field" id="cardNumField" style="display:none"><label>Card Number</label>
          <select id="fCardNum"></select>
        </div>
        <button class="btn btn-add" onclick="addToCollection()">+ Add Card</button>
      </div>
    </div>
  </div>

  <!-- Tab Navigation -->
  <div class="tab-nav">
    <button class="tab-btn active" onclick="switchTab('collection')" id="tab-collection">&#9876; Collection</button>
    <button class="tab-btn" onclick="switchTab('decks')" id="tab-decks">&#x2261; Saved Decks</button>
  </div>

  <!-- Collection Tab -->
  <div class="tab-pane active" id="pane-collection">
  <div class="coll-panel">
    <div class="panel-hdr">
      <div style="position:relative;display:inline-block">
        <button id="collFilterBtn" onclick="toggleCollDropdown()" style="font-family:'Cinzel',serif;font-size:13px;letter-spacing:3px;color:var(--gold);text-transform:uppercase;background:none;border:none;cursor:pointer;display:flex;align-items:center;gap:8px;padding:0">
          My Collection
          <span id="collFilterLabel" style="font-size:9px;color:var(--accent);letter-spacing:1px"></span>
          <span style="font-size:10px;color:var(--silver-dim)">&#9660;</span>
        </button>
        <div id="collDropdown" style="display:none;position:absolute;top:calc(100% + 8px);left:0;background:#1a0505;border:1px solid var(--border);border-radius:10px;min-width:160px;z-index:50;box-shadow:0 8px 24px rgba(0,0,0,0.5);overflow:hidden">
          <div class="coll-filter-opt" onclick="setCollTypeFilter('')">All Cards</div>
          <div class="coll-filter-opt" onclick="setCollTypeFilter('monster')">&#x25CF; Monsters</div>
          <div class="coll-filter-opt" onclick="setCollTypeFilter('spell')">&#x25CF; Spells</div>
          <div class="coll-filter-opt" onclick="setCollTypeFilter('trap')">&#x25CF; Traps</div>
        </div>
      </div>
      <div style="display:flex;align-items:center;gap:16px;flex-wrap:wrap">
        <div style="position:relative">
          <input type="text" id="collSearch" placeholder="&#x1F50D; Filter collection..." autocomplete="off"
            style="background:rgba(12,3,3,0.8);border:1px solid var(--border);border-radius:8px;color:var(--white);font-family:'Crimson Pro',serif;font-size:14px;padding:7px 32px 7px 12px;outline:none;width:220px;transition:border-color 0.2s"
            oninput="filterCollection()">
          <span id="collClear" onclick="clearCollSearch()" style="display:none;position:absolute;right:8px;top:50%;transform:translateY(-50%);cursor:pointer;color:var(--silver-dim);font-size:14px">&#x2715;</span>
        </div>
        <div class="stats-row">
          <div class="stat"><span class="stat-n" id="statUnique">0</span><span class="stat-l">Unique</span></div>
          <div class="stat"><span class="stat-n" id="statTotal">0</span><span class="stat-l">Total Cards</span></div>
        </div>
      </div>
    </div>
    <div class="tbl-wrap">
      <table>
        <thead><tr id="tableHeaders">
          <th style="width:36px"></th>
          <th onclick="sortBy('name')"      class="sortable" style="min-width:160px">Card Name <span class="sort-icon" id="si-name"></span></th>
          <th onclick="sortBy('type')"      class="sortable">Type <span class="sort-icon" id="si-type"></span></th>
          <th onclick="sortBy('attribute')" class="sortable">Attribute <span class="sort-icon" id="si-attribute"></span></th>
          <th onclick="sortBy('archetype')" class="sortable">Archetype <span class="sort-icon" id="si-archetype"></span></th>
          <th onclick="sortBy('atk')"       class="sortable">ATK/DEF <span class="sort-icon" id="si-atk"></span></th>
          <th onclick="sortBy('cardNumber')" class="sortable">Card No. <span class="sort-icon" id="si-cardNumber"></span></th>
          <th onclick="sortBy('level')" class="sortable">Level <span class="sort-icon" id="si-level"></span></th>
          <th onclick="sortBy('rarity')"    class="sortable" style="min-width:120px">Rarity <span class="sort-icon" id="si-rarity"></span></th>
          <th onclick="sortBy('condition')" class="sortable">Condition <span class="sort-icon" id="si-condition"></span></th>
          <th onclick="sortBy('edition')"   class="sortable">Edition <span class="sort-icon" id="si-edition"></span></th>
          <th onclick="sortBy('qty')"       class="sortable">Qty <span class="sort-icon" id="si-qty"></span></th>
          <th></th>
        </tr></thead>
        <tbody id="collBody">
          <tr><td colspan="13"><div class="empty-st"><div class="empty-ic">&#9876;</div><p class="empty-tx">Loading&hellip;</p></div></td></tr>
        </tbody>
      </table>
    </div>
    <div class="rarity-breakdown" id="rarityBreakdown"></div>
    <div class="exp-bar">
      <button class="btn btn-gold" onclick="exportCSV()">&#8595; Export CSV for Excel</button>
    </div>
  </div>

  <!-- Deck Builder -->
  <div class="deck-section">
    <div class="deck-hdr">
      <div class="deck-ttl">&#9876; Deck Builder</div>
      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
        <span id="deckTotalCount" style="font-family:'Cinzel',serif;font-size:11px;color:var(--silver-dim);letter-spacing:1px">0 / 40+ cards</span>
        <input type="text" id="deckName" placeholder="Deck name..." style="background:rgba(12,3,3,0.8);border:1px solid var(--border);border-radius:8px;color:var(--white);font-family:'Crimson Pro',serif;font-size:14px;padding:6px 12px;outline:none;width:180px">
        <button class="btn btn-gold" style="padding:8px 16px;font-size:9px" onclick="saveDeck()">&#x2713; Save Deck</button>
        <button class="btn btn-gold" style="padding:8px 16px;font-size:9px" onclick="exportDeck()">&#8595; Export .ydk</button>
        <label class="btn" style="padding:8px 16px;font-size:9px;background:rgba(40,80,160,0.3);color:var(--silver);cursor:pointer" title="Import a .ydk file">&#8593; Import .ydk<input type="file" id="ydkImportInput" accept=".ydk,.txt" style="display:none" onchange="importYdk(this)"></label>
        <button class="btn" style="padding:8px 16px;font-size:9px;background:rgba(160,30,30,0.3);color:var(--silver)" onclick="clearDeck()">Clear</button>
      </div>
    </div>
    <div class="deck-search-row" style="position:relative">
      <span style="font-family:'Cinzel',serif;font-size:9px;letter-spacing:2px;color:var(--silver-dim);text-transform:uppercase">Add from collection:</span>
      <input type="text" id="deckSearch" placeholder="Search your collection..." autocomplete="off"
        style="background:rgba(12,3,3,0.8);border:1px solid var(--border);border-radius:8px;color:var(--white);font-family:'Crimson Pro',serif;font-size:14px;padding:7px 12px;outline:none;width:240px"
        oninput="filterDeckSearch()">
      <div id="deckSearchResults" style="display:none;position:absolute;margin-top:36px;background:#1a0505;border:1px solid var(--border);border-radius:10px;max-height:200px;overflow-y:auto;z-index:50;box-shadow:0 8px 24px rgba(0,0,0,0.5);min-width:280px"></div>
    </div>
    <div class="deck-zones">
      <div class="deck-zone">
        <div class="deck-zone-hdr">
          <span>Main Deck</span>
          <span class="deck-zone-count" id="mainCount">0</span>
        </div>
        <div class="deck-card-list" id="mainDeck"></div>
      </div>
      <div class="deck-zone">
        <div class="deck-zone-hdr">
          <span>Extra Deck</span>
          <span class="deck-zone-count" id="extraCount">0</span>
        </div>
        <div class="deck-card-list" id="extraDeck"></div>
      </div>
      <div class="deck-zone">
        <div class="deck-zone-hdr">
          <span>Side Deck</span>
          <span class="deck-zone-count" id="sideCount">0</span>
        </div>
        <div class="deck-card-list" id="sideDeck"></div>
      </div>
    </div>
  </div>

</div>

  <!-- Saved Decks Tab -->
  <div class="tab-pane" id="pane-decks">
    <div class="coll-panel">
      <div class="panel-hdr" style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px">
        <div style="font-family:'Cinzel',serif;font-size:13px;letter-spacing:3px;color:var(--gold);text-transform:uppercase">
          &#x2261; Saved Decks
          <span id="savedDeckCount" style="font-size:10px;color:var(--silver-dim);margin-left:10px"></span>
        </div>
      </div>
      <div class="saved-decks-grid" id="savedDecksGrid"></div>
    </div>
  </div>

<div id="cardModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.85);z-index:1000;align-items:center;justify-content:center;padding:24px" onclick="if(event.target===this)closeCardModal()">
  <div style="background:#1a0505;border:1px solid var(--border);border-radius:20px;max-width:720px;width:100%;box-shadow:0 0 60px rgba(160,30,30,0.5);position:relative;overflow:hidden">
    <button onclick="closeCardModal()" style="position:absolute;top:14px;right:18px;background:none;border:none;color:var(--silver-dim);font-size:26px;cursor:pointer;z-index:1;line-height:1">&#x2715;</button>
    <div style="display:grid;grid-template-columns:240px 1fr;gap:0">
      <div style="background:#0e0303">
        <img id="modalImg" src="" alt="" style="width:100%;display:block" onerror="this.style.display=&quot;none&quot;">
      </div>
      <div style="padding:28px 28px 28px 22px;display:flex;flex-direction:column;gap:14px">
        <div id="modalName" style="font-family:'Cinzel',serif;font-size:22px;font-weight:700;color:var(--gold-pale);line-height:1.3"></div>
        <div id="modalMeta" style="display:flex;flex-wrap:wrap;gap:8px"></div>
        <div id="modalAtkDef" style="font-family:'Cinzel',serif;font-size:16px;color:var(--silver);letter-spacing:1px"></div>
        <div id="modalSet" style="font-size:15px;color:var(--silver-dim)"></div>
        <div id="modalEffect" style="font-size:15px;color:var(--silver);line-height:1.8;font-style:italic;border-left:2px solid rgba(192,57,43,0.4);padding-left:14px;max-height:260px;overflow-y:auto"></div>
      </div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script src="app.js"></script>
</body>
</html>
